<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>debug</title>

    <script type="text/javascript" src="DataStorage.js"></script>

    <script type="text/javascript">
        window.addEventListener('load', main, false);

        class Ingredient {
            constructor() {

            }
        }
        class Recipe {
            constructor() {

            }
        }
        class Meal {
            constructor() {

            }
        }

        function main() {
            //  Define an instance of `DataStorage`
            window.data = new DataStorage('mealplan', [Ingredient, Recipe, Meal]);

            //  Encrypt a data string with a given password
            console.log('encrypting \'some data\' with password \'password\'');
            let enc = data._encrypt('some data', 'password');

            enc.then(function(cipher) {
                //  Output the result of the encryption
                console.log('encrypted cipher:\n%o', cipher);
                return cipher;
            })
            .then(function(cipher) {
                //  Decrypt the result back to the original string
                console.log('decrypting cipher');
                return data._decrypt(cipher, 'password');
            })
            .then(function(plaintext) {
                //  Output the result of the decryption
                console.log('decrypted plaintext:', plaintext);
            });
        }

        /** Demonstration of JavaScript `async` and `await` declarations
         *     The `async` keyword causes a function to return an implicit `Promise`
         *     The `await` keyword causes execution to pause until a Promise returned by the `await`ed function resolves
         *
         * @param str
         * @param algo
         * @returns {Promise<string>}
         */
        async function hash(str = 'some data', algo = 'SHA-256') {
            // console.debug(`Compute hash digest of ${typeof str === 'string' ? `string (length ${str.length})` : `${typeof str}`} using ${alg} algorithm\nvalue: ${str}`);

            //  SubtleCrypto.digest() returns a Promise, so this function needs only to return that promise
            let buf = new TextEncoder('utf-8').encode(str);

            let buff = await window.crypto.subtle.digest(algo, buf);
            let view = new Uint8Array(buff);
            return view.reduce((prev, curr) => {return prev.concat(curr.toString(16).padStart(2, '0'))}, '');
        }
    </script>
</head>
<body>

</body>
</html>